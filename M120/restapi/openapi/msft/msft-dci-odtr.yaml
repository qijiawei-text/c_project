---
swagger: "2.0"
info:
  description: "Data model for OTDR"
  version: "1.0"
  title: "dci-otdr API"
host: "localhost:1234"
consumes:
- "application/yang-data+json"
produces:
- "application/yang-data+json"
paths:
  /data/optical-otdr/:
    get:
      tags:
      - "dci-otdr"
      summary: "returns dci.otdr.OtdrModule"
      description: "returns dci.otdr.OtdrModule"
      parameters: []
      responses:
        200:
          description: "dci.otdr.OtdrModule"
          schema:
            $ref: "#/definitions/dci.otdr.OtdrModuleWrapper"
        400:
          description: "Internal error"
    post:
      tags:
      - "dci-otdr"
      summary: "creates dci.otdr.OtdrModule"
      description: "creates dci.otdr.OtdrModule"
      parameters:
      - in: "body"
        name: "dci.otdr.OtdrModule.body-param"
        description: "dci.otdr.OtdrModule to be added to list"
        required: false
        schema:
          $ref: "#/definitions/dci.otdr.OtdrModuleWrapper"
      responses:
        201:
          description: "Object created"
        400:
          description: "Internal error"
        409:
          description: "Object already exists"
    put:
      tags:
      - "dci-otdr"
      summary: "creates or updates dci.otdr.OtdrModule"
      description: "creates or updates dci.otdr.OtdrModule"
      parameters:
      - in: "body"
        name: "dci.otdr.OtdrModule.body-param"
        description: "dci.otdr.OtdrModule to be added or updated"
        required: false
        schema:
          $ref: "#/definitions/dci.otdr.OtdrModuleWrapper"
      responses:
        201:
          description: "Object created"
        400:
          description: "Internal error"
        204:
          description: "Object modified"
    delete:
      tags:
      - "dci-otdr"
      summary: "removes dci.otdr.OtdrModule"
      description: "removes dci.otdr.OtdrModule"
      parameters: []
      responses:
        400:
          description: "Internal error"
        204:
          description: "Object deleted"
  /data/optical-otdr/config/:
    get:
      tags:
      - "dci-otdr"
      summary: "returns dci.otdr.otdrmodule.Config"
      description: "user configured, customized scan config"
      parameters: []
      responses:
        200:
          description: "dci.otdr.otdrmodule.Config"
          schema:
            $ref: "#/definitions/dci.otdr.otdrmodule.ConfigWrapper"
        400:
          description: "Internal error"
    post:
      tags:
      - "dci-otdr"
      summary: "creates dci.otdr.otdrmodule.Config"
      description: "user configured, customized scan config"
      parameters:
      - in: "body"
        name: "dci.otdr.otdrmodule.Config.body-param"
        description: "dci.otdr.otdrmodule.Config to be added to list"
        required: false
        schema:
          $ref: "#/definitions/dci.otdr.otdrmodule.ConfigWrapper"
      responses:
        201:
          description: "Object created"
        400:
          description: "Internal error"
        409:
          description: "Object already exists"
    put:
      tags:
      - "dci-otdr"
      summary: "creates or updates dci.otdr.otdrmodule.Config"
      description: "user configured, customized scan config"
      parameters:
      - in: "body"
        name: "dci.otdr.otdrmodule.Config.body-param"
        description: "dci.otdr.otdrmodule.Config to be added or updated"
        required: false
        schema:
          $ref: "#/definitions/dci.otdr.otdrmodule.ConfigWrapper"
      responses:
        201:
          description: "Object created"
        400:
          description: "Internal error"
        204:
          description: "Object modified"
    delete:
      tags:
      - "dci-otdr"
      summary: "removes dci.otdr.otdrmodule.Config"
      description: "user configured, customized scan config"
      parameters: []
      responses:
        400:
          description: "Internal error"
        204:
          description: "Object deleted"
  /data/optical-otdr/otdr-port/:
    post:
      tags:
      - "dci-otdr"
      summary: "creates dci.otdr.otdrmodule.OtdrPort"
      description: "creates dci.otdr.otdrmodule.OtdrPort"
      parameters:
      - in: "body"
        name: "dci.otdr.otdrmodule.OtdrPort.body-param"
        description: "dci.otdr.otdrmodule.OtdrPort to be added to list"
        required: false
        schema:
          $ref: "#/definitions/dci.otdr.otdrmodule.OtdrPortWrapper"
      responses:
        201:
          description: "Object created"
        400:
          description: "Internal error"
        409:
          description: "Object already exists"
  /data/optical-otdr/otdr-port={port-name}/:
    get:
      tags:
      - "dci-otdr"
      summary: "returns dci.otdr.otdrmodule.OtdrPort"
      description: "returns dci.otdr.otdrmodule.OtdrPort"
      parameters:
      - name: "port-name"
        in: "path"
        description: "Id of otdr-port"
        required: true
        type: "string"
      responses:
        200:
          description: "dci.otdr.otdrmodule.OtdrPort"
          schema:
            $ref: "#/definitions/dci.otdr.otdrmodule.OtdrPortWrapper"
        400:
          description: "Internal error"
    put:
      tags:
      - "dci-otdr"
      summary: "creates or updates dci.otdr.otdrmodule.OtdrPort"
      description: "creates or updates dci.otdr.otdrmodule.OtdrPort"
      parameters:
      - name: "port-name"
        in: "path"
        description: "Id of otdr-port"
        required: true
        type: "string"
      - in: "body"
        name: "dci.otdr.otdrmodule.OtdrPort.body-param"
        description: "dci.otdr.otdrmodule.OtdrPort to be added or updated"
        required: false
        schema:
          $ref: "#/definitions/dci.otdr.otdrmodule.OtdrPortWrapper"
      responses:
        201:
          description: "Object created"
        400:
          description: "Internal error"
        204:
          description: "Object modified"
    delete:
      tags:
      - "dci-otdr"
      summary: "removes dci.otdr.otdrmodule.OtdrPort"
      description: "removes dci.otdr.otdrmodule.OtdrPort"
      parameters:
      - name: "port-name"
        in: "path"
        description: "Id of otdr-port"
        required: true
        type: "string"
      responses:
        400:
          description: "Internal error"
        204:
          description: "Object deleted"
  /data/optical-otdr/otdr-port={port-name}/config/:
    get:
      tags:
      - "dci-otdr"
      summary: "returns dci.otdr.OtdrPortConfig"
      description: "returns dci.otdr.OtdrPortConfig"
      parameters:
      - name: "port-name"
        in: "path"
        description: "Id of otdr-port"
        required: true
        type: "string"
      responses:
        200:
          description: "dci.otdr.OtdrPortConfig"
          schema:
            $ref: "#/definitions/dci.otdr.OtdrPortConfigWrapper"
        400:
          description: "Internal error"
    post:
      tags:
      - "dci-otdr"
      summary: "creates dci.otdr.OtdrPortConfig"
      description: "creates dci.otdr.OtdrPortConfig"
      parameters:
      - name: "port-name"
        in: "path"
        description: "Id of otdr-port"
        required: true
        type: "string"
      - in: "body"
        name: "dci.otdr.OtdrPortConfig.body-param"
        description: "dci.otdr.OtdrPortConfig to be added to list"
        required: false
        schema:
          $ref: "#/definitions/dci.otdr.OtdrPortConfigWrapper"
      responses:
        201:
          description: "Object created"
        400:
          description: "Internal error"
        409:
          description: "Object already exists"
    put:
      tags:
      - "dci-otdr"
      summary: "creates or updates dci.otdr.OtdrPortConfig"
      description: "creates or updates dci.otdr.OtdrPortConfig"
      parameters:
      - name: "port-name"
        in: "path"
        description: "Id of otdr-port"
        required: true
        type: "string"
      - in: "body"
        name: "dci.otdr.OtdrPortConfig.body-param"
        description: "dci.otdr.OtdrPortConfig to be added or updated"
        required: false
        schema:
          $ref: "#/definitions/dci.otdr.OtdrPortConfigWrapper"
      responses:
        201:
          description: "Object created"
        400:
          description: "Internal error"
        204:
          description: "Object modified"
    delete:
      tags:
      - "dci-otdr"
      summary: "removes dci.otdr.OtdrPortConfig"
      description: "removes dci.otdr.OtdrPortConfig"
      parameters:
      - name: "port-name"
        in: "path"
        description: "Id of otdr-port"
        required: true
        type: "string"
      responses:
        400:
          description: "Internal error"
        204:
          description: "Object deleted"
  /data/optical-otdr/otdr-port={port-name}/state/:
    get:
      tags:
      - "dci-otdr"
      summary: "returns dci.otdr.OtdrPortState"
      description: "returns dci.otdr.OtdrPortState"
      parameters:
      - name: "port-name"
        in: "path"
        description: "Id of otdr-port"
        required: true
        type: "string"
      responses:
        200:
          description: "dci.otdr.OtdrPortState"
          schema:
            $ref: "#/definitions/dci.otdr.OtdrPortStateWrapper"
        400:
          description: "Internal error"
  /data/optical-otdr/otdr-port={port-name}/state/last-scan-result/:
    get:
      tags:
      - "dci-otdr"
      summary: "returns dci.otdr.OtdrScanResult"
      description: "returns dci.otdr.OtdrScanResult"
      parameters:
      - name: "port-name"
        in: "path"
        description: "Id of otdr-port"
        required: true
        type: "string"
      responses:
        200:
          description: "dci.otdr.OtdrScanResult"
          schema:
            $ref: "#/definitions/dci.otdr.OtdrScanResultWrapper"
        400:
          description: "Internal error"
  /data/optical-otdr/otdr-port={port-name}/state/last-scan-result/otdr-event={event-id}/:
    get:
      tags:
      - "dci-otdr"
      summary: "returns dci.otdr.otdrscanresult.OtdrEvent"
      description: "List of detected events, 0..99."
      parameters:
      - name: "port-name"
        in: "path"
        description: "Id of otdr-port"
        required: true
        type: "string"
      - name: "event-id"
        in: "path"
        description: "Id of otdr-event"
        required: true
        type: "integer"
        format: "int64"
      responses:
        200:
          description: "dci.otdr.otdrscanresult.OtdrEvent"
          schema:
            $ref: "#/definitions/dci.otdr.otdrscanresult.OtdrEventWrapper"
        400:
          description: "Internal error"
  /data/optical-otdr/pre-config={trace-type}/:
    get:
      tags:
      - "dci-otdr"
      summary: "returns dci.otdr.OtdrScanConfig"
      description: "pre-defined scan config"
      parameters:
      - name: "trace-type"
        in: "path"
        description: "Id of pre-config"
        required: true
        type: "string"
      responses:
        200:
          description: "dci.otdr.OtdrScanConfig"
          schema:
            $ref: "#/definitions/dci.otdr.OtdrScanConfigWrapper"
        400:
          description: "Internal error"
  /data/optical-otdr/state/:
    get:
      tags:
      - "dci-otdr"
      summary: "returns dci.otdr.OtdrModuleState"
      description: "returns dci.otdr.OtdrModuleState"
      parameters: []
      responses:
        200:
          description: "dci.otdr.OtdrModuleState"
          schema:
            $ref: "#/definitions/dci.otdr.OtdrModuleStateWrapper"
        400:
          description: "Internal error"
  /operations/get-scan-result/:
    post:
      tags:
      - "dci-otdr"
      summary: "operates on dci.otdr.GetScanResult"
      description: "operates on dci.otdr.GetScanResult"
      parameters:
      - in: "body"
        name: "dci.otdr.getscanresult.Input.body-param"
        required: false
        schema:
          properties:
            input:
              $ref: "#/definitions/dci.otdr.getscanresult.Input"
      responses:
        200:
          description: "Correct response"
          schema:
            $ref: "#/definitions/dci.otdr.GetScanResult"
        201:
          description: "No response"
        400:
          description: "Internal error"
  /operations/start-scan/:
    post:
      tags:
      - "dci-otdr"
      summary: "operates on dci.otdr.StartScan"
      description: "operates on dci.otdr.StartScan"
      parameters:
      - in: "body"
        name: "dci.otdr.startscan.Input.body-param"
        required: false
        schema:
          properties:
            input:
              $ref: "#/definitions/dci.otdr.startscan.Input"
      responses:
        200:
          description: "Correct response"
          schema:
            $ref: "#/definitions/dci.otdr.StartScan"
        201:
          description: "No response"
        400:
          description: "Internal error"
  /operations/trace-baseline/:
    post:
      tags:
      - "dci-otdr"
      summary: "operates on dci.otdr.TraceBaseline"
      description: "operates on dci.otdr.TraceBaseline"
      parameters:
      - in: "body"
        name: "dci.otdr.tracebaseline.Input.body-param"
        required: false
        schema:
          properties:
            input:
              $ref: "#/definitions/dci.otdr.tracebaseline.Input"
      responses:
        200:
          description: "Correct response"
          schema:
            $ref: "#/definitions/dci.otdr.TraceBaseline"
        201:
          description: "No response"
        400:
          description: "Internal error"
definitions:
  dci.otdr.EventTypeEnumeration:
    type: "string"
    enum:
    - "non-reflective"
    - "reflective"
    - "fiber-end"
  dci.otdr.GetScanResult:
    type: "object"
    properties:
      output:
        $ref: "#/definitions/dci.otdr.getscanresult.Output"
  dci.otdr.Operation:
    type: "string"
    enum:
    - "get"
    - "set"
  dci.otdr.OtdrMode:
    type: "string"
    enum:
    - "Measuring"
    - "idle"
  dci.otdr.OtdrModule:
    type: "object"
    properties:
      otdr-port:
        type: "array"
        items:
          $ref: "#/definitions/dci.otdr.otdrmodule.OtdrPort"
      state:
        $ref: "#/definitions/dci.otdr.OtdrModuleState"
      pre-config:
        type: "array"
        description: "pre-defined scan config"
        items:
          $ref: "#/definitions/dci.otdr.OtdrScanConfig"
      config:
        description: "user configured, customized scan config"
        $ref: "#/definitions/dci.otdr.otdrmodule.Config"
  dci.otdr.OtdrModuleState:
    type: "object"
    properties:
      otdr-mode:
        description: "Indicates which mode OTDR is in."
        $ref: "#/definitions/dci.otdr.OtdrMode"
  dci.otdr.OtdrModuleStateWrapper:
    properties:
      state:
        $ref: "#/definitions/dci.otdr.OtdrModuleState"
  dci.otdr.OtdrModuleWrapper:
    properties:
      optical-otdr:
        $ref: "#/definitions/dci.otdr.OtdrModule"
  dci.otdr.OtdrPara:
    type: "object"
    properties:
      pulse-width:
        type: "integer"
        format: "int64"
        description: "Scan pulse width."
      sample-resolution:
        type: "string"
        description: "Sampling resolution."
      distance-range:
        type: "integer"
        format: "int64"
        description: "Scan distance range."
  dci.otdr.OtdrPortConfig:
    type: "object"
    properties:
      launch-cable-length:
        type: "integer"
        format: "int64"
        default: 30
      port-name:
        type: "string"
        description: "Reference to EDFA line port"
  dci.otdr.OtdrPortConfigWrapper:
    properties:
      config:
        $ref: "#/definitions/dci.otdr.OtdrPortConfig"
  dci.otdr.OtdrPortState:
    type: "object"
    properties:
      otdr-mode:
        description: "Measuring or idle"
        $ref: "#/definitions/dci.otdr.OtdrMode"
      last-scan-result:
        $ref: "#/definitions/dci.otdr.OtdrScanResult"
  dci.otdr.OtdrPortStateWrapper:
    properties:
      state:
        $ref: "#/definitions/dci.otdr.OtdrPortState"
  dci.otdr.OtdrScanConfig:
    allOf:
    - $ref: "#/definitions/dci.otdr.OtdrPara"
    - $ref: "#/definitions/dci.otdr.OtdrThr"
    - type: "object"
      properties:
        measuring-time:
          type: "integer"
          format: "int64"
          description: "Scan measuring time."
        user-ior:
          type: "string"
          description: "Sampling resolution."
        trace-type:
          $ref: "#/definitions/dci.otdr.TraceType"
  dci.otdr.OtdrScanConfigWrapper:
    properties:
      pre-config:
        $ref: "#/definitions/dci.otdr.OtdrScanConfig"
  dci.otdr.OtdrScanResult:
    type: "object"
    properties:
      return-loss:
        type: "string"
        description: "The value is output with three decimal place."
      event-count:
        type: "integer"
        format: "int64"
        description: "Count of the event."
      otdr-event:
        type: "array"
        description: "List of detected events, 0..99."
        items:
          $ref: "#/definitions/dci.otdr.otdrscanresult.OtdrEvent"
      fiber-length:
        type: "integer"
        format: "int64"
        description: "Distance unit, IOR correction distance data."
      total-loss:
        type: "string"
        description: "Total power loss."
      completion-time:
        type: "string"
        description: "Time scan was completed."
      port-name:
        type: "string"
  dci.otdr.OtdrScanResultWrapper:
    properties:
      last-scan-result:
        $ref: "#/definitions/dci.otdr.OtdrScanResult"
  dci.otdr.OtdrScanTrigger:
    type: "object"
    properties:
      event-trigger:
        type: "boolean"
        description: "enable/disable event-driven scan, based on LOS or spanloss change\
          \ alarm."
        default: false
      interval:
        type: "integer"
        format: "int64"
        description: "interval for periodical scan, set 0 to disable it."
        default: 0
  dci.otdr.OtdrThr:
    type: "object"
    properties:
      reflectance-thr:
        type: "string"
      fiber-end-thr:
        type: "string"
      splice-loss-thr:
        type: "string"
  dci.otdr.StartScan:
    type: "object"
    properties:
      output:
        $ref: "#/definitions/org.openroadm.common.types.RpcResponseStatus"
  dci.otdr.TraceBaseline:
    type: "object"
    properties:
      output:
        $ref: "#/definitions/dci.otdr.tracebaseline.Output"
  dci.otdr.TraceType:
    type: "string"
    enum:
    - "customized"
    - "short"
    - "medium"
    - "long"
  dci.otdr.getscanresult.Input:
    type: "object"
    properties:
      sor-file:
        type: "boolean"
        description: "Scan result returned as the filename of SOR file. Otherwise,\
          \ the result also include data fomat defined as otdr-scan-result."
        default: true
      port-name:
        type: "string"
        description: "The choice describes the option to specify the entity for getting\
          \ scan result."
  dci.otdr.getscanresult.Output:
    allOf:
    - $ref: "#/definitions/dci.otdr.OtdrScanResult"
    - $ref: "#/definitions/org.openroadm.common.types.RpcResponseStatus"
    - type: "object"
      properties:
        result-file:
          type: "string"
          description: "The SOR file path and filename on the device to be downloaded"
  dci.otdr.otdrmodule.Config:
    allOf:
    - $ref: "#/definitions/dci.otdr.OtdrScanConfig"
    - $ref: "#/definitions/dci.otdr.OtdrScanTrigger"
  dci.otdr.otdrmodule.ConfigWrapper:
    properties:
      config:
        $ref: "#/definitions/dci.otdr.otdrmodule.Config"
  dci.otdr.otdrmodule.OtdrPort:
    type: "object"
    properties:
      state:
        $ref: "#/definitions/dci.otdr.OtdrPortState"
      config:
        $ref: "#/definitions/dci.otdr.OtdrPortConfig"
      port-name:
        type: "string"
        description: "Reference to the name of the port"
        x-path: "../config/port-name"
  dci.otdr.otdrmodule.OtdrPortWrapper:
    properties:
      otdr-port:
        $ref: "#/definitions/dci.otdr.otdrmodule.OtdrPort"
  dci.otdr.otdrscanresult.OtdrEvent:
    type: "object"
    properties:
      reflectance:
        type: "string"
        description: "Reflection power."
      event-type:
        description: "Indicates which event is detected."
        $ref: "#/definitions/dci.otdr.EventTypeEnumeration"
      fiber-length:
        type: "integer"
        format: "int64"
        description: "Location of the event."
      total-loss:
        type: "string"
        description: "Total power loss."
      event-id:
        type: "integer"
        format: "int64"
      event-loss:
        type: "string"
        description: "Splice loss."
  dci.otdr.otdrscanresult.OtdrEventWrapper:
    properties:
      otdr-event:
        $ref: "#/definitions/dci.otdr.otdrscanresult.OtdrEvent"
  dci.otdr.startscan.Input:
    type: "object"
    properties:
      distance:
        type: "integer"
        format: "int64"
        description: "optional: distance override the global config"
      resolution:
        type: "integer"
        format: "int64"
        description: "optional: resolution to override the global config"
      port-name:
        type: "string"
        description: "The choice describes the option to specify the entity for the\
          \ start-scan RPC. 'ALL' for scanning all ports."
      trace-type:
        description: "use customized/configured or fixed templates to scan"
        $ref: "#/definitions/dci.otdr.TraceType"
  dci.otdr.tracebaseline.Input:
    type: "object"
    properties:
      operation:
        description: "The operation to use."
        $ref: "#/definitions/dci.otdr.Operation"
  dci.otdr.tracebaseline.Output:
    allOf:
    - $ref: "#/definitions/org.openroadm.common.types.RpcResponseStatus"
    - type: "object"
      properties:
        result-file:
          type: "array"
          description: "The SOR files path and filename on the device to be downloaded"
          items:
            type: "string"
  org.openroadm.common.types.RpcResponseStatus:
    type: "object"
    properties:
      status-message:
        type: "string"
        description: "Gives a more detailed status"
      status:
        description: "Successful or Failed"
        $ref: "#/definitions/org.openroadm.common.types.RpcStatus"
  org.openroadm.common.types.RpcStatus:
    type: "string"
    enum:
    - "Successful"
    - "Failed"
